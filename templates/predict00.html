{% extends "base.html" %}
{% block content %}

<h3>Browse for the image</h3>

<div>
    <form id="upload-file" method="post" enctype="multipart/form-data">
        <label for="imageUpload" class="upload-label">
            Upload image...
        </label>
        <input type="file" name="file" id="imageUpload" accept=".png, .jpg, .jpeg">
    </form>

    <div class="image-section" style="display:none;">
        <div class="img-preview">
            <div id="imagePreview"></div>
        </div>
        <div>
            <button type="button" class="btn btn-primary btn-lg" id="btn-predict">Predict!</button>
        </div>
    </div>

    <div class="loader" style="display:none;"></div>

    <div>
        <h4>Generated Caption:</h4>
        <p id="result-caption"></p>
        <h4>Result:</h4>
        <p id="result-results"></p>




    </div>
</div>

<script>
    // Show preview and section
    document.getElementById('imageUpload').addEventListener('change', function () {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const preview = document.getElementById('imagePreview');
                preview.innerHTML = `<img src="${e.target.result}" width="300"/>`;
                document.querySelector('.image-section').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });

    // Handle predict button click
    document.getElementById('btn-predict').addEventListener('click', async function () {
        const form = document.getElementById('upload-file');
        const formData = new FormData(form);

        document.querySelector('.loader').style.display = 'block';

        const response = await fetch('/predict', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();
        console.log(data);  // ðŸ§ª See what is returned
        document.querySelector('.loader').style.display = 'none';
        document.getElementById('result-caption').textContent = data.caption || "No caption";
        document.getElementById('result-results').textContent = data.results || "No Results";


    });
</script>

{% endblock %}